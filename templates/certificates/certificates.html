{% extends "layout.html" %}
{% block head %}
		<style type="text/css">
			abbr[title] { border-bottom: none; cursor: default }
			a.cert-link { text-decoration: none !important; color: inherit }
			a.cert-link abbr[title] { cursor: pointer }
			a.cert-link:hover abbr[title] { cursor: pointer; text-decoration: underline !important }
		</style>
{% endblock %}
{% block body %}
<div class="page-header">
	<h3>
		<div class="pull-right">
			<a href="{{ url_for('certificates_download_csv') }}" class="btn btn-primary"><i class="fa fa-fw fa-download"></i> <span class="hidden-sm hidden-xs">Download CSV</span></a>
			<a href="{{ url_for('certificates_add') }}" class="btn btn-success"><i class="fa fa-fw fa-plus"></i> <span class="hidden-sm hidden-xs">Add Certificate</span></a>
		</div>
		<i class="fa fa-fw fa-shield"></i> Certificates
	</h3>
	<p class="text-muted">The list below shows both automatically detected and manually inserted certificates.</p>
</div>
<table class="table table-condensed table-striped" id="data">
	<thead>
		<tr>
			<th title="The CN of the Subject of the certificate. Hover over a row to see the full DN.">Subject CN</th>
			<th title="The CN of the CA that issued the certificate. Hover over a row to see the full DN.">Issuer CN</th>
			<th title="The start date of the certificate. Hover over a row to see the full date and time.">Valid From</th>
			<th title="The expiry date of the certificate. Hover over a row to see the full date and time.">Expiry</th>
			<th title="The last time the certificate was seen during a scan. Hover over a row to see the full date and time.">Last Seen</th>
			<th title="Number of unique locations (i.e. IP:Port) presenting this certificate on the network">Host Count</th>
			<th title="Size of the public key in bits">Key Size</th>
			<th></th>
		</tr>
	</thead>
	<tbody>
{%- for cert in certificates %}
		<tr {% if cert.notAfter < utcnow() %}class="text-danger" {% endif %}data-digest="{{ cert.digest }}">
			<td><a href="{{url_for('certificate_edit',digest=cert.digest) }}" class="cert-link"><abbr title="{{ cert.subjectDN }}">{{ cert.subjectCN }}</abbr></a></td>
			<td><abbr title="{{ cert.issuerDN }}">{{ cert.issuerCN }}</abbr></td>
			<td>{% if cert.notBefore %}<abbr title="{{ cert.notBefore }}">{{ cert.notBefore.strftime("%Y-%m-%d") }}</abbr>{% else %}Unknown{% endif %}</td>
			<td>{% if cert.notAfter %}<abbr title="{{ cert.notAfter }}">{{ cert.notAfter.strftime("%Y-%m-%d") }}</abbr>{% else %}Unknown{% endif %}</td>
			<td>{% if cert.lastSeen %}<abbr title="{{ cert.lastSeen }}">{{ cert.lastSeen.strftime("%Y-%m-%d") }}</abbr>{% else %}Unknown{% endif %}</td>
			<td>{{ cert.numHosts }}</td>
			<td>{{ cert.keySize or "Unknown" }}</td>
			<td><a href="{{url_for('certificate_edit',digest=cert.digest) }}" class="btn btn-default btn-xs"><i class="fa fa-fw fa-wrench"></i> Manage</a></td>
		</tr>
{%- endfor %}
	</tbody>
</table>
<script type="text/javascript">
// Define variable for nodes table.
var nodes;
$(function() {
	nodes = $('#data').DataTable({
		"lengthMenu": [[10,15,50,100,-1], [10,15,50,100,'All']],
		"pageLength": 15,
		"order": [[0, 'asc']],
		"stateSave": true,
		"columns": [null, null, null, null, null, null, null, { "orderable": false, "targets": 0 }]
	});
});
</script>
{% endblock %}
